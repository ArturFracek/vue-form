<!DOCTYPE html>
<!-- saved from url=(0042)https://cv.parleto.io/media/files/vue.html -->
<html>
  <head>
    <meta charset="utf-8">
    <title>Recruitment task</title>
    <meta name="robots" content="noindex">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
  </head>
  <body>
    <div id="app">
      <div style="display: flex; gap: 2em;">
        <div>
          <h1>TODO</h1> 
          <ol>
            <template v-for="task in taskList">
              <task-item :task="task">
                <ol type="a" v-if="task.subtaskList">
                  <template v-for="subtask in task.subtaskList">
                    <task-item :task="subtask"></task-item>  
                  </template>
                </ol> 
              </task-item>  
            </template>
          </ol>
            <h2>Hints</h2> 
              <ol>
                yarn global add browser-sync<br>
                browser-sync --watch .
                </li> 
                <li>&lt;datalist&gt;</li>
              </ol>
        </div>            
      </div>
      <h2>Workers</h2>
      <div id="add-workers-form">
        <filter-workers-form  @input="setFilters" style="width: 100%;"></filter-workers-form>
        <add-workers-form  @input="addWorker" style="width: 100%;"></add-workers-form>
      </div>
      <table style="width: 70%;" border="1">
        <tbody>
          <tr v-for="(worker, index) in filteredWorkers" :key="index">
            <td>{{index+1}}</td>
            <td>{{worker.firstName}}</td>
            <td>{{worker.lastName}}</td>
            <td>{{worker.department}}</td>
            <td>{{worker.salary.amount}} {{worker.salary.currency}}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3"></td>
            <td>Summary</td>
            <td>{{ salarySum }}</td>
          </tr>
        </tfoot>
      </table>
    </div>

    <script>
function getEmptyWorker () {
  return {
    firstName: "",
    lastName: "",
    department: "",
    salary: {
      amount: "",
      currency: "",
    },
  }
}

const TaskItem = Vue.component('task-item', {
  props: {
    task: Object
  },
  template: '<li>{{task.title}} {{ task.completed ? "✅" : "❌"}}<slot name="default"></slot></li>'
});
const addWorkersForm = Vue.component("add-workers-form", {
  template: `<div>
    <input v-model="person.firstName" style="width: 14%; height: 5%;" type="text" class="addFirstName" placeholder="First Name"></input>
    <input v-model="person.lastName" style="width: 14%; height: 5%;" type="text" class="addLastName" placeholder="Last Name"></input>
    <select v-model="person.department" style="width: 22.5%; height: 5%;" name="departments" id="departments" placeholder="Deparment">
      <option value="">Select a department</option>
      <option value="IT">IT</option>
      <option value="Sales">Sales</option>
      <option value="Administration">Administration</option>
    </select>
    <input v-model="person.salary.amount" style="width: 8.5% ; height: 5%;" type="text" class="addSalary" placeholder="Salary"></input>
    <select v-model="person.salary.currency" style="width: 8%; height: 5%; margin-right: 8px;" name="currency" id="currency">
      <option value="USD">USD</option>
      <option value="PLN">PLN</option>
      <option value="EUR">EUR</option>
    </select>
    <button @click="addWorker" style="width: 15%; height: 5%;" type="button">Add worker</button>
  </div>`,
  data() {
    return{
      person: getEmptyWorker()
    }
  },
  methods: {
    addWorker() {
      this.$emit("input", { ...this.person, salary: { ...this.person.salary } })
      this.person = getEmptyWorker()
    }
  }
 
})
const filterWorkersForm = Vue.component("filter-workers-form", {
  template: `<div>
    <input v-model="filters.name" style="width: 29%; height: 5%;" type="text" class="addFirstName" placeholder="Worker"></input>
    <input v-model="filters.departments" type="checkbox" value="IT">IT
    <input v-model="filters.departments" type="checkbox" value="Sales">Sales
    <input v-model="filters.departments" type="checkbox" value="Administration">Administration
    <input v-model="filters.minSalary" style="width: 7.9% ; height: 5%;" type="text" class="addSalary" placeholder="min. salary"></input>
    <input v-model="filters.maxSalary" style="width: 7.9% ; height: 5%;" type="text" class="addSalary" placeholder="max. salary"></input>
    <button @click="setFilters" style="width: 15%; height: 5%;" type="button">Filter Workers</button>
  </div>`,
  data() {
    return {
     filters: {
       name: '',
       departments: [],
       minSalary: undefined,
       maxSalary: undefined,
     }
    }
  },
  methods: {
    setFilters() {
      this.$emit("input", {...this.filters})
    }
  }
})

new Vue({
  el: "#app",
  name: "main",
  components: {
    TaskItem,
    addWorkersForm,
    filterWorkersForm,
  },
  data: {
    filters: {},
    workerList: [
      { "firstName": "John", "lastName": "Smith", "department": "IT", "salary": { "amount": 3000, "currency": "USD" }, "id": Math.random(), },
      { "firstName": "Jane", "lastName": "Doe", "department": "IT", "salary": { "amount": 3000.50, "currency": "USD" }, "id": Math.random() },
      { "firstName": "Bob", "lastName": "Colman", "department": "Sales", "salary": { "amount": 9000, "currency": "USD" }, "id": Math.random() },
      { "firstName": "Barbara", "lastName": "O'Connor", "department": "Sales", "salary": { "amount": 4000, "currency": "USD" }, "id": Math.random() },
      { "firstName": "Adam", "lastName": "Murphy", "department": "Administration", "salary": { "amount": 2000, "currency": "USD" }, "id": Math.random() }
    ],
    taskList: [
      { 
        "title": "Add form to add new worker",
        "completed":true,
        "subtaskList": [
          { "title": "firstName", "completed": true },
          { "title": "lastName", "completed": true },
          { "title": "department", "completed": true },
          { "title": "salary amount and currency", "completed": true }
        ]
      },
      { 
        "title": "Add search form", 
        "completed": false,
        "subtaskList": [
          { "title": "person (text)", "completed": false },
          { "title": "department (multiple choice)", "completed": false },
          { "title": "salary (range)", "completed": false }
        ]
      },
      { 
        "title": "Add summary of salary per department", 
        "completed": false
      },
      {
        "title": "Other improvements (feel free to add other improvements)",
        "completed": false
      }
    ],
  },
  computed: {
    splitedName() {
      return (this.filters.name || '').split(" ")
    },
    salarySum() {
      return this.workerList.reduce((acc, i) => acc + parseFloat(i.salary.amount || 0,10), 0);
    },
    filteredWorkers() {
      return this.workerList
        .filter(this.filterByName)
        .filter(this.filterByDepartments)
    }
  },
  methods: {
    addWorker(worker) {
     this.workerList.push(worker)
    },
    setFilters(allFilters) {
      this.filters = allFilters
      console.log(this.filters.departments) 
    },
    filterByName(w) {
      if (!this.filters.name) return true
      return w.firstName.includes(this.splitedName[0] || this.splitedName[1]) || w.lastName.includes(this.splitedName[0] || this.splitedName[1])
    },
    filterByDepartments(w) {
      if (!this.filters.departments) return true
      return w.department === this.filters.departments[0] || w.department === this.filters.departments[1] || w.department === this.filters.departments[2]
    }
  }
});
    </script>
  

</body></html>