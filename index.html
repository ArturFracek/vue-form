<!DOCTYPE html>
<!-- saved from url=(0042)https://cv.parleto.io/media/files/vue.html -->
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <title>Recruitment task</title>
    <meta name="robots" content="noindex">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.min.js"></script>
  </head>
  <body>
    <div id="app">
      <div class="guidelines">
          <h1>TODO</h1> 
          <ol>
            <template v-for="task in taskList">
              <task-item :task="task">
                <ol type="a" v-if="task.subtaskList">
                  <template v-for="subtask in task.subtaskList">
                    <task-item :task="subtask"></task-item>  
                  </template>
                </ol> 
              </task-item>  
            </template>
          </ol>
          <ol>
            <h2>Hints</h2> 
            yarn global add browser-sync<br>
            browser-sync --watch .
            <li>&lt;datalist&gt;</li>
          </ol>
        </div>            
      <div class="workers__title">Workers</div>
      <div id="filters-workers-form">
        <filter-workers-form  @input="setFilters"></filter-workers-form>
      </div>
      <div id="add-workers-form">
        <add-workers-form  @input="addWorker"></add-workers-form>
      </div>
      <table class="workers__table" border='1'>
        <tbody>
          <thead>
           <th></th>
            <th v-for="(i, index) in workersInfo" class="workers__table--info" >
              {{i.minorHeader}}
            <th/>
          </thead>
          <tr v-for="(worker, index) in filteredWorkers" :key="index">
            <td style="width: 8px;" >{{index+1 +"."}}</td>
            <td>{{worker.firstName}}</td>
            <td>{{worker.lastName}}</td>
            <td>{{worker.department}}</td>
            <td>{{worker.salary.amount}} {{worker.salary.currency}}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3"></td>
            <td>Summary</td>
            <td>{{ salarySum }}</td>
          </tr>
        </tfoot>
      </table>
      <salary-per-department :workers="workerList"></salary-per-department>
    </div>
  </div>

    <script>
function getEmptyWorker () {
  return {
    firstName: "",
    lastName: "",
    department: "",
    salary: {
      amount: "",
      currency: "",
    },
  }
}

const TaskItem = Vue.component('task-item', {
  props: {
    task: Object
  },
  template: '<li>{{task.title}} {{ task.completed ? "✅" : "❌"}}<slot name="default"></slot></li>'
});
const addWorkersForm = Vue.component("add-workers-form", {
  template: `
  <div class="workers__form">
    <div class="workers__usageTitle">Add Worker</div>
    <input v-model="person.firstName" class="workers__formItem" type="text" placeholder="First Name"></input>
    <input v-model="person.lastName" class="workers__formItem" type="text" placeholder="Last Name"></input>
    <select v-model="person.department" class="workers__formItem" name="departments" placeholder="Deparment">
      <option value="">Department</option>
      <option value="IT">IT</option>
      <option value="Sales">Sales</option>
      <option value="Administration">Administration</option>
    </select>
    <input v-model="person.salary.amount" class="workers__formItem" type="text" placeholder="Salary"></input>
    <select v-model="person.salary.currency" class="workers__formItem" name="currency">
      <option value="">Currency</option>
      <option value="USD">USD</option>
      <option value="PLN">PLN</option>
      <option value="EUR">EUR</option>
    </select>
    <button @click="addWorker" class="workers__formItem--addButton button__primary" type="button">Add Worker</button>
  </div>`,
  data() {
    return{
      person: getEmptyWorker()
    }
  },
  methods: {
    addWorker() {
      this.$emit("input", { ...this.person, salary: { ...this.person.salary } })
      this.person = getEmptyWorker()
    }
  }
 
})
const filterWorkersForm = Vue.component("filter-workers-form", {
  template: `<div class="workers__form workers__form--borderBottom">
    <div class="workers__usageTitle">Filters</div>
    <input v-model="filters.name" class="workers__formItem" type="text" placeholder="Worker"></input>
    <div class="workers__checkbox--Container">
    <label for="IT">IT</label>
    <input v-model="filters.departments" class="workers__formItem workers__formItem--checkbox" type="checkbox" value="IT" name="IT"></input>
    </div>
    <div class="workers__checkbox--Container">
    <label for="Sales">Sales</label>
    <input v-model="filters.departments" class="workers__formItem workers__formItem--checkbox" type="checkbox" value="Sales" name="Sales"></input>
    </div>
    <div class="workers__checkbox--Container">
    <label for="Administration">Administration</label>
    <input v-model="filters.departments" class="workers__formItem workers__formItem--checkbox" type="checkbox" value="Administration" name="Administration"></input>
    </div>
    <input v-model="filters.minSalary" class="workers__formItem" type="text" placeholder="min. Salary"></input>
    <input v-model="filters.maxSalary" class="workers__formItem" type="text" placeholder="max. Salary"></input>
    <button @click="setFilters" class="workers__formItem--addButton button__primary" type="button">Filter Workers</button>
  </div>`,
  data() {
    return {
     filters: {
       name: "",
       departments: [],
       minSalary: undefined,
       maxSalary: undefined,
     }
    }
  },
  methods: {
    setFilters() {
      this.$emit("input", {...this.filters})
    }
  }
})

const salaryPerDepartment = Vue.component("salary-per-department", {
  template: `<div class="workers__form workers__form--salaryPerDepartment">
    <div class="workers__usageTitle">Salary per Department</div>
    <table style="width: 70%;" border="1">
        <tbody>
          <tr>
            <th class="workers__table--info">Department</th>
            <th class="workers__table--info">Summary</th>
          </tr>
          <tr v-for="(department, index) in uniqueDepartments" :key="index">
            <td>{{department}}</td>
            <td>{{salaryOfDepartment(department)}}</td>
          </tr>
        </tbody>
      </table>
  </div>`,
  data() {
    return {
    }
  },
  props: {
    workers: {
      type: Array,
      required: false,
    }
  },
  computed: {
    salaryByDepartment() {
      return this.uniqueDepartments === this.workers.map(w=> w.department) ? this.workers.map(w=>w.salary) : ''
    },
    uniqueDepartments() {
      return [...new Set(this.workers.map(w=>w.department))]
    }
  },
  methods: {
    salaryOfDepartment(department) {
     const salaryArrByDepartment = this.workers.map(w => w.department === department ? w.salary.amount : 0)
     return salaryArrByDepartment.reduce((acc, c) => acc + parseFloat(c), 0)
    },
    test() {
      console.log(this.salaryOfDepartment())
    }
  }
})

new Vue({
  el: "#app",
  name: "main",
  components: {
    TaskItem,
    addWorkersForm,
    filterWorkersForm,
  },
  data: {
    workersInfo: [
    {"minorHeader": "First Name"},
    {"minorHeader": "Last Name"},
    {"minorHeader": "Department"},
    {"minorHeader": "Salary"},
  ],
    filters: {},
    workerList: [
      { "firstName": "John", "lastName": "Smith", "department": "IT", "salary": { "amount": 3000, "currency": "USD" }},
      { "firstName": "Jane", "lastName": "Doe", "department": "IT", "salary": { "amount": 3000.50, "currency": "USD" }},
      { "firstName": "Bob", "lastName": "Colman", "department": "Sales", "salary": { "amount": 9000, "currency": "USD" }},
      { "firstName": "Barbara", "lastName": "O'Connor", "department": "Sales", "salary": { "amount": 4000, "currency": "USD" }},
      { "firstName": "Adam", "lastName": "Murphy", "department": "Administration", "salary": { "amount": 2000, "currency": "USD" }}
    ],
    taskList: [
      { 
        "title": "Add form to add new worker",
        "completed":true,
        "subtaskList": [
          { "title": "firstName", "completed": true },
          { "title": "lastName", "completed": true },
          { "title": "department", "completed": true },
          { "title": "salary amount and currency", "completed": true }
        ]
      },
      { 
        "title": "Add search form", 
        "completed": true,
        "subtaskList": [
          { "title": "person (text)", "completed": true },
          { "title": "department (multiple choice)", "completed": true},
          { "title": "salary (range)", "completed": true }
        ]
      },
      { 
        "title": "Add summary of salary per department", 
        "completed": true
      },
      {
        "title": "Other improvements (feel free to add other improvements)",
        "completed": true
      }
    ],
  },
  computed: {
    salarySum() {
      return this.filteredWorkers.reduce((acc, i) => acc + parseFloat(i.salary.amount || 0,10), 0);
    },
    filteredWorkers() {
      return this.workerList
        .filter(this.filterByName)
        .filter(this.filterByDepartments)
        .filter(this.filterBySalaryRange)
    }
  },
  methods: {
    addWorker(worker) {
     this.workerList.push(worker)
    },
    setFilters(allFilters) {
      this.filters = allFilters
      console.log(this.filteredWorkers) 
    },
    filterByName(w) {
      if (!this.filters.name) return true
      const loweredName = `${w.firstName} ${w.lastName}`.toLowerCase()
      return loweredName.includes(this.filters.name.toLowerCase())
    },
    filterByDepartments(w) {
      const normalizedDepArray = this.filters.departments || []
      if (!normalizedDepArray.length) return true
      return normalizedDepArray.includes(w.department)
    },
    filterBySalaryRange(w) {
      const normalizedMinimalSalary = this.filters.minSalary || 0
      const normalizedMaxSalary = this.filters.maxSalary || 10000000
      return normalizedMinimalSalary <= w.salary.amount && normalizedMaxSalary >= w.salary.amount
    }
  }
});
    </script>
  

</body></html>